<lib name='jquery'/>
<lib name="jquery.ui" />
<lib name='jquery.farbtastic'/>
<css src="bannermanager:css/AdvertisementSetting.css" />
<h1>Banner设置</h1>
<msgqueue />
	<div class="ad_button">
		<a href="?c=org.opencomb.bannermt.CreateAdvertisement">新建Banner</a>
		<a href="?c=org.opencomb.bannermt.CarouselAdvertisement">新建随机Banner</a>
	</div>
	<div class="ad_line_title">
		<div class="ad_title">广告名称</div>
		<div class="ad_type">广告类型</div>
		<div class="ad_operate">操作</div>
	</div>
	<foreach for="$arrAdvertisement" key='sKeyPath' item='arrAItemList'>
	
		<div class="ad_line">
			<div class="ad_title">{=$arrAItemList['name']}</div>
			<div class="ad_type">{=$arrAItemList['type']}</div>
			<div class="ad_operate">
				<a href="?c=org.opencomb.bannermt.{=$arrAItemList['classtype2']}&aid={=$sKeyPath}">删除</a>
				<a href="?c=org.opencomb.bannermt.{=$arrAItemList['classtype']}&aid={=$sKeyPath}">编辑</a>
				<a href="javascript:void(0)" onclick="javascript:jquery('#{=$sKeyPath.'code'}').toggle()">代码</a>
				<a href="javascript:void(0)" onclick="viewAdEdit('{=$sKeyPath}')">放置</a>
			</div>
			<div class="clr"></div>
			<div id="{=$sKeyPath}viewAdEdit" style="display:none;" class="hViewEdit" >
				<form method="post">
					<div class="ad_controller">
						<div class="ad_controller_name">
							<span>被放置控制器名:</span>
							<input type="text" name="controllername" style="width:300px" id="bannercontrollername{=$sKeyPath}"/>
							<a href="javascript:viod(0)"  onclick="testBrowserController('{=$sKeyPath}')" id="mergeCtl_pageToView_findPage_btn">浏览</a>
							<input type="submit" value="放置" class="ad_fz"/>
						</div>
						<div class="ad_controller_parameter">
							<span>参  数:</span>
							<input type="text" name="banner_controller_params" style="width:300px" id="bannercontrollerparams{=$sKeyPath}"/>
							<input type="hidden" id="{=$sKeyPath}hidden_Ad_Name" name="hidden_ad_Name"/>
						</div>
					</div>
					<if"true">
						<foreach for="$arrViewAdvertisement" key='sControllerAd' item='ControllerAdList'>
							<if "{=$sKeyPath==$ControllerAdList['advertisementName']}">
								<div class="ad_controller_old">
									<span style="color:red;">已放置控制器名:</span>{=$ControllerAdList['controllerName']}
									<a href="?c=org.opencomb.bannermt.AdvertisementSetting&dAdname={=$sControllerAd}" class="ad_del"></a>
									<a target="_blank" href="?c={=$ControllerAdList['controllerName']}" class="ad_preview"></a>
								</div>
							</if>
						</foreach>
					</if>
				</form>
			</div>
			<div id="{=$sKeyPath}code" style="display:none;" class="hCode">
				<p>代码:&lt;widget type='advertisment' attr.id="{=$sKeyPath}" /&gt;</p>
				<span>说明:可以将上述代码复制到网页中使用，例如模板编织可以使用此代码</span>
			</div>	
		</div>
		
	</foreach>	
<script>
	function testBrowserController(sBannerName)
	{
			jquery.ajax({
				url : '?c=org.opencomb.bannermt.BannerStructBrowser&rspn=noframe',
				type: "POST",
				data : {'allowSelectClass':'c'},
				dataType : 'html',
				success : function(html) {
					jquery('body').append('<div id="mergeCtl_select_dialog" style="width:700px;height:500px;"></div>');
					
					jquery("#mergeCtl_select_dialog").append(html);
					
					var dialog = jquery("#mergeCtl_select_dialog").dialog({
						width: 700
						, height: 500
						, title: '选择网页'
						, zIndex:710
						, maximize:false
						, minimize:false
						,resize: function(event, ui) {
							structBrowser.resizeFrame(ui.size.width);
						}
					}) ;
					structBrowser.resizeFrame(700 , 510);
					
					structBrowser.onSelectChange = function(data){
						dialog.dialog('close');
						//jquery("#mergeCtl_pageToView_page_span").html(data['class']);
						
						jquery("#bannercontrollername"+sBannerName).val(data['class'].replace(/\\/g,'.'));
						jquery("#bannercontrollerparams"+sBannerName).val(data['params']);
						
					};
				}
			});
	}
	
	function viewAdEdit(adName)
	{
		jquery("#"+adName+"viewAdEdit").toggle(function(){document.getElementById(adName+'hidden_Ad_Name').value=adName;});
	}
	
	function displayCode(adName)
	{
		document.getElementById(adName+'code').style.display="";
	}
	

</script>
